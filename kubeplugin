#!/bin/bash

# This script is a kubectl plugin that gets resource usage statistics for pods or nodes.
# It should be saved as 'kubectl-resource-stats' - preferred but not required naming convention and made executable.

if [[ -z "$1" ]] || [[ "$2" != "-n" ]] || [[ -z "$3" ]]; then
  echo "Usage: kubectl-resource-stats <pods|nodes> -n <namespace>"
  exit 1
fi

RESOURCE_TYPE=$1
NAMESPACE=$3

kubectl top "$RESOURCE_TYPE" -n "$NAMESPACE" | tail -n +2 | while read -r line
do
  NAME=$(echo "$line" | awk '{print $1}')
  CPU=$(echo "$line" | awk '{print $2}')
  MEMORY=$(echo "$line" | awk '{print $3}')

  echo "Resource: $RESOURCE_TYPE, Namespace: $NAMESPACE, Name: $NAME, CPU: $CPU, Memory: $MEMORY"
done
